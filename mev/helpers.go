package mev

import "github.com/ethereum/go-ethereum/core/types"

func HasRealSwapAfterDecode(tx *types.Transaction) bool {
	// GETH không decode sâu
	// STEP-1 đã đủ
	return true
}

func ExtractSwapInfo(tx *types.Transaction) *SwapExtract {
	data := tx.Data()
	if len(data) < 4 {
		return nil
	}

	var sel [4]byte
	copy(sel[:], data[:4])

	switch sel {

	// V2 router
	case
		[4]byte{0x38, 0xed, 0x17, 0x39},
		[4]byte{0x7f, 0xf3, 0x6a, 0xb5},
		[4]byte{0x18, 0xcb, 0xaf, 0xe5},
		[4]byte{0x5c, 0x11, 0xd7, 0x95},
		[4]byte{0xb6, 0xf9, 0xde, 0x95},
		[4]byte{0x79, 0x1a, 0xc9, 0x47}:
		return &SwapExtract{SwapType: "v2_router"}

	// V3 router
	case
		[4]byte{0x04, 0xe4, 0x5a, 0xaf},
		[4]byte{0xb8, 0x58, 0x18, 0x3f},
		[4]byte{0x09, 0xb8, 0x13, 0x46},
		[4]byte{0x50, 0x23, 0xb4, 0xdf}:
		return &SwapExtract{SwapType: "v3_router"}

	// V2 pool
	case [4]byte{0x02, 0x2c, 0x0d, 0x9f}:
		return &SwapExtract{SwapType: "v2_pool"}

	// Multicall / execute / universal
	case
		[4]byte{0xac, 0x96, 0x50, 0xd8},
		[4]byte{0x5a, 0xe4, 0x01, 0xdc},
		[4]byte{0x35, 0x93, 0x56, 0x4c},
		[4]byte{0x7c, 0x02, 0x52, 0x00},
		[4]byte{0x09, 0xc5, 0xea, 0xbe},
		[4]byte{0x1c, 0xff, 0x79, 0xcd}:
		return &SwapExtract{SwapType: "multicall"}
	}

	return nil
}
